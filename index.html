<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gram Shakti | Premium Web Design</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  body { 
    background: linear-gradient(to bottom right, #fdf4eb, #fffde7, #e0f2fe);
    font-family: 'Noto Sans Devanagari', 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .app-card {
    background: white;
    width: 100%;
    max-width: 480px;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    animation: fadeIn 0.8s ease-out;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .input-field {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #e0e0e0;
    margin-top: 10px;
    outline: none;
    transition: all 0.3s ease;
    font-size: 16px;
  }
  .input-field:focus {
    border-color: #f97316;
    box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
  }
  .btn-primary {
    width: 100%;
    padding: 16px;
    background: linear-gradient(90deg, #f97316, #ea580c);
    color: white;
    border-radius: 14px;
    font-size: 18px;
    font-weight: 700;
    margin-top: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 20px rgba(249, 115, 22, 0.4);
  }
  .btn-primary:hover {
    opacity: 0.9;
    transform: translateY(-2px);
    box-shadow: 0 12px 25px rgba(249, 115, 22, 0.5);
  }
  .btn-primary:active {
    transform: translateY(0);
    box-shadow: 0 6px 15px rgba(249, 115, 22, 0.3);
  }
  .state-grid-item {
    background: #fff;
    border: 1px solid #f97316;
    color: #f97316;
    padding: 15px;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
    cursor: pointer;
    font-size: 15px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }
  .state-grid-item:hover {
    background: #fdf2e9;
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  }
  .state-grid-item:active {
    transform: translateY(0);
  }
  .highlight-danger {
    background: #fee2e2;
    border-left: 4px solid #ef4444;
    color: #ef4444;
    padding: 10px;
    border-radius: 8px;
    margin-top: 8px;
    animation: flashRed 1s infinite alternate;
  }
  @keyframes flashRed {
    from { opacity: 0.8; }
    to { opacity: 1; transform: scale(1.01); }
  }
  .header-logo {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    color: #f97316;
    font-size: 2.2rem;
    line-height: 1;
  }
</style>
</head>
<body>

<div id="app-container" class="app-card">
  </div>

<div id="msgBox" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
  <div id="msgContent" class="bg-white p-8 rounded-3xl text-center w-full max-w-xs shadow-2xl"></div>
</div>

<script>
/* üî• Firebase Setup */
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
  projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userFlow = { state: "", district: "", panchayat: "", village: "" };
const badWords = ["‡§ó‡§æ‡§≤‡•Ä", "sala", "haram", "pagal", "bad", "foul", "chutiya", "bhenchod"]; // ‡§Ö‡§ß‡§ø‡§ï ‡§∂‡§¨‡•ç‡§¶ ‡§ú‡•ã‡§°‡§º‡•á ‡§ó‡§è

// --- 1. ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡§Ø‡§® ---
function showStates() {
  const states = [
    'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 
    'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand', 
    'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur', 
    'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 
    'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura', 
    'Uttar Pradesh', 'Uttarakhand', 'West Bengal'
  ];
  
  let html = `
    <div class="flex items-center justify-between mb-8">
      <div id="adminLogo" class="w-12 h-12 bg-f97316 text-white rounded-full flex items-center justify-center text-2xl font-bold cursor-pointer select-none shadow-md">G</div>
      <h1 class="header-logo">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
      <div class="w-12"></div>
    </div>
    <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">‡§Ö‡§™‡§®‡§æ ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h2>
    <div class="grid grid-cols-2 gap-4 h-[350px] overflow-y-auto pr-2">`;
  states.forEach(s => { html += `<div class="state-grid-item" onclick="selectState('${s}')">${s}</div>`; });
  document.getElementById("app-container").innerHTML = html + `</div>`;
  setupAdminHold();
}

function selectState(s) { userFlow.state = s; showDistrictStep(); }

// --- 2. ‡§ú‡§ø‡§≤‡§æ ---
function showDistrictStep() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <h2 class="text-xl font-semibold text-gray-800 mb-2">‡§ú‡§ø‡§≤‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <p class="text-sm text-gray-500 mb-6">${userFlow.state}</p>
    <input id="distInp" class="input-field" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§™‡§ü‡§®‡§æ, ‡§ú‡§Ø‡§™‡•Å‡§∞...">
    <button onclick="saveDistrict()" class="btn-primary">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
  `;
}
function saveDistrict() {
  const val = document.getElementById("distInp").value.trim();
  if(!val) return showMessage('error', "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç!");
  userFlow.district = val;
  showPanchayatStep();
}

// --- 3. ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ---
function showPanchayatStep() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <h2 class="text-xl font-semibold text-gray-800 mb-2">‡§Ö‡§™‡§®‡•Ä ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <p class="text-sm text-gray-500 mb-6">${userFlow.district}, ${userFlow.state}</p>
    <input id="panchInp" class="input-field" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞ ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§...">
    <button onclick="savePanchayat()" class="btn-primary">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
  `;
}
function savePanchayat() {
  const val = document.getElementById("panchInp").value.trim();
  if(!val) return showMessage('error', "‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç!");
  userFlow.panchayat = val;
  showVillageStep();
}

// --- 4. ‡§ó‡§æ‡§Å‡§µ ---
function showVillageStep() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <h2 class="text-xl font-semibold text-gray-800 mb-2">‡§Ö‡§™‡§®‡•á ‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <p class="text-sm text-gray-500 mb-6">${userFlow.panchayat}, ${userFlow.district}</p>
    <input id="villInp" class="input-field" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: ‡§®‡§Ø‡§æ‡§ó‡§æ‡§Å‡§µ, ‡§ï‡§ø‡§∂‡§®‡§™‡•Å‡§∞...">
    <button onclick="saveVillage()" class="btn-primary">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}
function saveVillage() {
  const val = document.getElementById("villInp").value.trim();
  if(!val) return showMessage('error', "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç!");
  userFlow.village = val;
  showOptions(); // ‡§Ø‡§π‡§æ‡§Å ‡§∏‡•á ‡§ö‡•Å‡§®‡§æ‡§µ ‡§ï‡§∞‡•á‡§Ç - ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï
}

// --- 5. ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ (‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä / ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï) ---
function showOptions() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <p class="text-center text-gray-500 text-sm mb-8">${userFlow.village}, ${userFlow.panchayat}, ${userFlow.district}, ${userFlow.state}</p>
    <button onclick="showRegistration()" class="btn-primary">ü§ù ‡§Æ‡•à‡§Ç ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§π‡•Ç‡§Å (‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£)</button>
    <button onclick="showCustomerView()" class="btn-primary !bg-white !text-f97316 border border-f97316 mt-4 shadow-sm">üîç ‡§∏‡•á‡§µ‡§æ ‡§¢‡•Ç‡§Ç‡§¢‡•á‡§Ç (‡§ó‡•ç‡§∞‡§æ‡§π‡§ï)</button>
    <button onclick="showStates()" class="w-full text-center text-gray-400 text-sm mt-8 underline">‡§∏‡•ç‡§•‡§æ‡§® ‡§¨‡§¶‡§≤‡•á‡§Ç</button>
  `;
}

// --- 6. ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® ‡§´‡•â‡§∞‡•ç‡§Æ ---
function showRegistration() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <p class="text-center text-gray-500 text-sm mb-6">${userFlow.village} ‡§Æ‡•á‡§Ç ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</p>
    
    <input id="wname" class="input-field" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
    <input id="wphone" class="input-field" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ (‡§â‡§¶‡§æ: 9876543210)" type="tel">
    
    <select id="wwork" class="input-field">
      <option value="">‡§ï‡§æ‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç (‡§∏‡•Å‡§à ‡§∏‡•á JCB ‡§§‡§ï)</option>
      <optgroup label="‡§≠‡§æ‡§∞‡•Ä ‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä">
        <option>JCB Operator</option><option>Tractor Driver</option><option>Combine Harvester</option>
      </optgroup>
      <optgroup label="‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä & ‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞">
        <option>‡§∞‡§æ‡§ú‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option><option>‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§®</option><option>‡§™‡•ç‡§≤‡§Ç‡§¨‡§∞</option><option>‡§¨‡•ù‡§à</option><option>‡§™‡•á‡§Ç‡§ü‡§∞</option><option>‡§¶‡§∞‡•ç‡§ú‡•Ä</option>
      </optgroup>
      <optgroup label="‡§¶‡•Å‡§ï‡§æ‡§® & ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç">
        <option>‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§¶‡•Å‡§ï‡§æ‡§®</option><option>‡§¶‡•Ç‡§ß ‡§°‡•á‡§Ø‡§∞‡•Ä</option><option>‡§Æ‡•á‡§°‡§ø‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞</option><option>‡§ü‡•á‡§Ç‡§ü ‡§π‡§æ‡§â‡§∏</option><option>DJ ‡§∏‡§æ‡§â‡§Ç‡§°</option><option>‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ (‡§ï‡§æ‡§∞/‡§ë‡§ü‡•ã)</option>
      </optgroup>
      <optgroup label="‡§õ‡•ã‡§ü‡•Ä ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç">
        <option>‡§Æ‡§ú‡§¶‡•Ç‡§∞</option><option>‡§®‡§æ‡§à</option><option>‡§™‡§Ç‡§°‡§ø‡§§ ‡§ú‡•Ä</option><option>‡§π‡§≤‡§µ‡§æ‡§à</option><option>‡§∏‡§´‡§æ‡§à ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</option>
      </optgroup>
    </select>
    
    <button onclick="saveWorker()" class="btn-primary">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç</button>
    <button onclick="showOptions()" class="w-full text-center text-gray-400 text-sm mt-4 underline">‡§™‡•Ä‡§õ‡•á ‡§ú‡§æ‡§è‡§Å</button>
  `;
}

function saveWorker() {
  const n = document.getElementById("wname").value.trim();
  const p = document.getElementById("wphone").value.trim();
  const w = document.getElementById("wwork").value;
  if(!n || !p || !w) return showMessage('error', "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!");

  db.ref("workers").push({
    name: n, phone: p, work: w,
    location: `${userFlow.state}/${userFlow.district}/${userFlow.panchayat}/${userFlow.village}`,
    rating: 5,
    comments: [], // ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç
    time: Date.now()
  }).then(() => {
    showMessage('success', "‡§Ü‡§™‡§ï‡§æ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤ ‡§∞‡§π‡§æ!");
    showOptions(); // ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§µ‡§æ‡§™‡§∏ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§™‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç
  }).catch(e => {
    showMessage('error', "‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü: " + e.message);
  });
}

// --- 7. ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§µ‡•ç‡§Ø‡•Ç ---
function showCustomerView() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <p class="text-center text-gray-500 text-sm mb-6">‡§Ü‡§™‡§ï‡•á ‡§ó‡§æ‡§Å‡§µ ‡§Æ‡•á‡§Ç ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§∏‡•á‡§µ‡§æ‡§è‡§Ç</p>
    <div id="workerList" class="space-y-4 max-h-[350px] overflow-y-auto pr-2">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
    <button onclick="showOptions()" class="btn-primary !bg-white !text-f97316 border border-f97316 mt-6 shadow-sm">‡§™‡•Ä‡§õ‡•á ‡§ú‡§æ‡§è‡§Å</button>
  `;

  const currentPath = `${userFlow.state}/${userFlow.district}/${userFlow.panchayat}/${userFlow.village}`;
  db.ref("workers").on("value", (snapshot) => {
    let html = "";
    let found = false;
    snapshot.forEach((child) => {
      const worker = child.val();
      if (worker.location === currentPath) {
        found = true;
        html += `
          <div class="p-4 bg-white rounded-xl shadow-md border-l-4 border-f97316 flex justify-between items-center">
            <div>
              <p class="font-semibold text-gray-800 text-lg">${worker.name}</p>
              <p class="text-f97316 text-sm font-medium">${worker.work}</p>
            </div>
            <a href="tel:${worker.phone}" class="bg-green-500 text-white p-3 rounded-full shadow-lg">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
            </a>
          </div>`;
      }
    });
    document.getElementById("workerList").innerHTML = html || "<p class='text-center text-gray-500'>‡§á‡§∏ ‡§ó‡§æ‡§Å‡§µ ‡§Æ‡•á‡§Ç ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§∏‡•á‡§µ‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>";
  });
}

// --- ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ---
function setupAdminHold() {
  const logo = document.getElementById("adminLogo");
  let timer;
  logo.onmousedown = () => { timer = setTimeout(() => {
    let p = prompt("Master Password:");
    if(p === "Vikas0627.") showAdminPanel();
  }, 3000); };
  logo.onmouseup = () => clearTimeout(timer);
}

function showAdminPanel() {
  document.getElementById("app-container").innerHTML = `
    <div class="flex justify-between items-center mb-6 pb-4 border-b">
      <h2 class="text-2xl font-bold text-red-600">‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤</h2>
      <button onclick="showStates()" class="bg-gray-100 px-3 py-1 rounded-lg text-sm text-gray-700">Logout</button>
    </div>
    <div id="adminWorkerList" class="space-y-4 max-h-[400px] overflow-y-auto pr-2">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</div>
  `;

  db.ref("workers").on("value", (snap) => {
    let html = "";
    if (!snap.exists()) {
      html = "<p class='text-center text-gray-500'>‡§ï‡•ã‡§à ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>";
    } else {
      snap.forEach(child => {
        const data = child.val();
        const workerId = child.key;
        let commentHtml = "";
        let hasBadWord = false;

        if(data.comments && data.comments.length > 0) {
          data.comments.forEach(c => {
            const isBad = badWords.some(word => c.text.toLowerCase().includes(word));
            if (isBad) hasBadWord = true;
            commentHtml += `<p class="text-xs ${isBad ? 'highlight-danger' : 'bg-gray-50'} p-2 rounded-md mt-1">
                              ${c.user || '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§'}: ${c.text}
                              ${isBad ? '<span class="ml-1 font-bold">‚ö†Ô∏è</span>' : ''}
                            </p>`;
          });
        } else {
          commentHtml = "<p class='text-xs text-gray-400 mt-1'>‡§ï‡•ã‡§à ‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç</p>";
        }

        html += `
          <div class="p-4 bg-white rounded-xl shadow-md border-l-4 ${hasBadWord ? 'border-red-500' : 'border-f97316'}">
            <div class="flex justify-between items-start mb-2">
              <div>
                <p class="font-semibold text-lg">${data.name} (${data.work})</p>
                <p class="text-xs text-gray-500">${data.location}</p>
                <p class="text-f97316 font-semibold text-sm">${data.phone}</p>
              </div>
              <button onclick="deleteEntry('${workerId}')" class="bg-red-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-red-600 transition">‡§°‡§ø‡§≤‡•Ä‡§ü</button>
            </div>
            <div class="border-t pt-2 mt-2">
              <h4 class="font-semibold text-sm text-gray-700">‡§ï‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏:</h4>
              ${commentHtml}
              <input type="text" id="comment-${workerId}" class="input-field mt-3 mb-2" placeholder="‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§≤‡§ø‡§ñ‡•á‡§Ç...">
              <button onclick="addComment('${workerId}')" class="btn-primary !py-2 !text-sm !mt-0 !shadow-none">‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§ú‡•ã‡•ú‡•á‡§Ç</button>
            </div>
          </div>`;
      });
    }
    document.getElementById("adminWorkerList").innerHTML = html;
  });
}

function deleteEntry(id) {
  if(confirm("‡§∞‡§µ‡§ø ‡§≠‡§æ‡§à, ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§ï‡•ã ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) {
    db.ref("workers/" + id).remove()
      .then(() => showMessage('success', '‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§'))
      .catch((e) => showMessage('error', '‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message));
  }
}

function addComment(workerId) {
  const commentInput = document.getElementById(`comment-${workerId}`);
  const commentText = commentInput.value.trim();
  if (!commentText) {
    showMessage('error', '‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§');
    return;
  }

  const workerRef = db.ref(`workers/${workerId}/comments`);
  workerRef.push({
    text: commentText,
    user: "Master Admin", // ‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§ø‡§∏‡§®‡•á ‡§ï‡§ø‡§Ø‡§æ
    time: Date.now()
  })
  .then(() => {
    commentInput.value = ''; // ‡§á‡§®‡§™‡•Å‡§ü ‡§∏‡§æ‡•û ‡§ï‡§∞‡•á‡§Ç
    showMessage('success', '‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ‡•§');
  })
  .catch((e) => showMessage('error', '‡§ï‡§Æ‡•á‡§Ç‡§ü ‡§ú‡•ã‡§°‡§º‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + e.message));
}

// --- ‡§Ø‡•Ç‡§®‡§ø‡§µ‡§∞‡•ç‡§∏‡§≤ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§™‡•â‡§™‡§Ö‡§™ ---
function showMessage(type, message) {
  const msgContent = document.getElementById("msgContent");
  msgContent.innerHTML = `
    <div class="text-5xl mb-4">${type === 'success' ? '‚úÖ' : '‚ùå'}</div>
    <h3 class="text-xl font-bold ${type === 'success' ? 'text-green-600' : 'text-red-600'}">${type === 'success' ? '‡§∏‡§´‡§≤‡§§‡§æ!' : '‡§§‡•ç‡§∞‡•Å‡§ü‡§ø!'}</h3>
    <p class="mt-2 text-gray-700">${message}</p>
    <button onclick="document.getElementById('msgBox').classList.add('hidden')" class="mt-6 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white w-full py-3 rounded-xl font-bold">‡§†‡•Ä‡§ï ‡§π‡•à</button>
  `;
  document.getElementById("msgBox").classList.remove("hidden");
}

showStates(); // ‡§ê‡§™ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
</script>
</body>
</html>
