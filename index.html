// --- 1. FIREBASE SETUP (рдЕрдкрдиреА рдбрд┐рдЯреЗрд▓реНрд╕ рдпрд╣рд╛рдБ рднрд░реЗрдВ) ---
const firebaseConfig = { 
    apiKey: "YOUR_API_KEY", 
    databaseURL: "YOUR_DB_URL", 
    projectId: "YOUR_PROJECT_ID" 
};
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

// --- 2. DISTRICT DATA (Fixed List) ---
const distData = {
    "UP": ["рдЖрдЧрд░рд╛", "рдЕрд▓реАрдЧрдврд╝", "рдкреНрд░рдпрд╛рдЧрд░рд╛рдЬ", "рдЕрдореНрдмреЗрдбрдХрд░ рдирдЧрд░", "рдЕрдореЗрдареА", "рдЕрдорд░реЛрд╣рд╛", "рдФрд░реИрдпрд╛", "рдЕрдпреЛрдзреНрдпрд╛", "рдЖрдЬрд╝рдордЧрдврд╝", "рдмрд╛рдЧрдкрдд", "рдмрд╣рд░рд╛рдЗрдЪ", "рдмрд▓рд┐рдпрд╛", "рдмрд▓рд░рд╛рдордкреБрд░", "рдмрд╛рдВрджрд╛", "рдмрд╛рд░рд╛рдмрдВрдХреА", "рдмрд░реЗрд▓реА", "рдмрд╕реНрддреА", "рднрджреЛрд╣реА", "рдмрд┐рдЬрдиреМрд░", "рдмрджрд╛рдпреВрдВ", "рдмреБрд▓рдВрджрд╢рд╣рд░", "рдЪрдВрджреМрд▓реА", "рдЪрд┐рддреНрд░рдХреВрдЯ", "рджреЗрд╡рд░рд┐рдпрд╛", "рдПрдЯрд╛", "рдЗрдЯрд╛рд╡рд╛", "рдлрд╝рд░реНрд░реБрдЦрд╝рд╛рдмрд╛рдж", "рдлрд╝рддреЗрд╣рдкреБрд░", "рдлрд╝рд┐рд░реЛрдЬрд╝рд╛рдмрд╛рдж", "рдЧреМрддрдо рдмреБрджреНрдз рдирдЧрд░", "рдЧрд╛рдЬрд╝рд┐рдпрд╛рдмрд╛рдж", "рдЧрд╛рдЬрд╝реАрдкреБрд░", "рдЧреЛрдВрдбрд╛", "рдЧреЛрд░рдЦрдкреБрд░", "рд╣рдореАрд░рдкреБрд░", "рд╣рд╛рдкреБрдбрд╝", "рд╣рд░рджреЛрдИ", "рд╣рд╛рдерд░рд╕", "рдЬрд╛рд▓реМрди", "рдЬреМрдирдкреБрд░", "рдЭрд╛рдВрд╕реА", "рдХрдиреНрдиреМрдЬ", "рдХрд╛рдирдкреБрд░ рджреЗрд╣рд╛рдд", "рдХрд╛рдирдкреБрд░ рдирдЧрд░", "рдХрд╛рд╕рдЧрдВрдЬ", "рдХреМрд╢рд╛рдореНрдмреА", "рдХреБрд╢реАрдирдЧрд░", "рд▓рдЦреАрдордкреБрд░ рдЦреАрд░реА", "рд▓рд▓рд┐рддрдкреБрд░", "рд▓рдЦрдирдК", "рдорд╣рд░рд╛рдЬрдЧрдВрдЬ", "рдорд╣реЛрдмрд╛", "рдореИрдирдкреБрд░реА", "рдордереБрд░рд╛", "рдордК", "рдореЗрд░рда", "рдорд┐рд░реНрдЬрд╝рд╛рдкреБрд░", "рдореБрд░рд╛рджрд╛рдмрд╛рдж", "рдореБрдЬрд╝рдлреНрдлрд░рдирдЧрд░", "рдкреАрд▓реАрднреАрдд", "рдкреНрд░рддрд╛рдкрдЧрдврд╝", "рд░рд╛рдпрдмрд░реЗрд▓реА", "рд░рд╛рдордкреБрд░", "рд╕рд╣рд╛рд░рдирдкреБрд░", "рд╕рдВрднрд▓", "рд╕рдВрдд рдХрдмреАрд░ рдирдЧрд░", "рд╢рд╛рд╣рдЬрд╣рд╛рдБрдкреБрд░", "рд╢рд╛рдорд▓реА", "рд╢реНрд░рд╛рд╡рд╕реНрддреА", "рд╕рд┐рджреНрдзрд╛рд░реНрдердирдЧрд░", "рд╕реАрддрд╛рдкреБрд░", "рд╕реЛрдирднрджреНрд░", "рд╕реБрд▓реНрддрд╛рдирдкреБрд░", "рдЙрдиреНрдирд╛рд╡", "рд╡рд╛рд░рд╛рдгрд╕реА"],
    "RJ": ["рдЕрдЬрдореЗрд░", "рдЕрд▓рд╡рд░", "рдмрд╛рдВрд╕рд╡рд╛рдбрд╝рд╛", "рдмрд╛рд░рд╛рдВ", "рдмрд╛рдбрд╝рдореЗрд░", "рднрд░рддрдкреБрд░", "рднреАрд▓рд╡рд╛рдбрд╝рд╛", "рдмреАрдХрд╛рдиреЗрд░", "рдмреВрдВрджреА", "рдЪрд┐рддреНрддреМрдбрд╝рдЧрдврд╝", "рдЪреВрд░реВ", "рджреМрд╕рд╛", "рдзреМрд▓рдкреБрд░", "рдбреВрдВрдЧрд░рдкреБрд░", "рд╣рдиреБрдорд╛рдирдЧрдврд╝", "рдЬрдпрдкреБрд░", "рдЬреИрд╕рд▓рдореЗрд░", "рдЬрд╛рд▓реМрд░", "рдЭрд╛рд▓рд╛рд╡рд╛рдбрд╝", "рдЭреБрдВрдЭреБрдиреВ", "рдЬреЛрдзрдкреБрд░", "рдХрд░реМрд▓реА", "рдХреЛрдЯрд╛", "рдирд╛рдЧреМрд░", "рдкрд╛рд▓реА", "рдкреНрд░рддрд╛рдкрдЧрдврд╝", "рд░рд╛рдЬрд╕рдордВрдж", "рд╕рд╡рд╛рдИ рдорд╛рдзреЛрдкреБрд░", "рд╕реАрдХрд░", "рд╕рд┐рд░реЛрд╣реА", "рд╢реНрд░реА рдЧрдВрдЧрд╛рдирдЧрд░", "рдЯреЛрдВрдХ", "рдЙрджрдпрдкреБрд░", "рдмреНрдпрд╛рд╡рд░", "рдХреЗрдХрдбрд╝реА", "рд╕рд╛рдВрдЪреМрд░", "рдХреЛрдЯрдкреБрддрд▓реА", "рдлрд▓реЛрджреА", "рдмрд╛рд▓реЛрддрд░рд╛"],
    "MP": ["рдЕрдЧрд░ рдорд╛рд▓рд╡рд╛", "рдЕрд▓реАрд░рд╛рдЬрдкреБрд░", "рдЕрдиреВрдкрдкреБрд░", "рдЕрд╢реЛрдХрдирдЧрд░", "рдмрд╛рд▓рд╛рдШрд╛рдЯ", "рдмрдбрд╝рд╡рд╛рдиреА", "рдмреИрддреВрд▓", "рднрд┐рдВрдб", "рднреЛрдкрд╛рд▓", "рдмреБрд░рд╣рд╛рдирдкреБрд░", "рдЫрддрд░рдкреБрд░", "рдЫрд┐рдВрджрд╡рд╛рдбрд╝рд╛", "рджрдореЛрд╣", "рджрддрд┐рдпрд╛", "рджреЗрд╡рд╛рд╕", "рдзрд╛рд░", "рдбрд┐рдВрдбреМрд░реА", "рдЧреБрдирд╛", "рдЧреНрд╡рд╛рд▓рд┐рдпрд░", "рд╣рд░рджрд╛", "рдирд░реНрдорджрд╛рдкреБрд░рдо", "рдЗрдВрджреМрд░", "рдЬрдмрд▓рдкреБрд░", "рдЭрд╛рдмреБрдЖ", "рдХрдЯрдиреА", "рдЦрдВрдбрд╡рд╛", "рдЦрд░рдЧреЛрди", "рдореИрд╣рд░", "рдордВрдбрд▓рд╛", "рдордВрджрд╕реМрд░", "рдореБрд░реИрдирд╛", "рдирд░рд╕рд┐рдВрд╣рдкреБрд░", "рдиреАрдордЪ", "рдирд┐рд╡рд╛рдбрд╝реА", "рдкрд╛рдВрдвреБрд░реНрдирд╛", "рдкрдиреНрдирд╛", "рд░рд╛рдпрд╕реЗрди", "рд░рд╛рдЬрдЧрдврд╝", "рд░рддрд▓рд╛рдо", "рд░реАрд╡рд╛", "рд╕рд╛рдЧрд░", "рд╕рддрдирд╛", "рд╕рд┐рд╡рдиреА", "рд╢рд╣рдбреЛрд▓", "рд╢рд╛рдЬрд╛рдкреБрд░", "рд╢реНрдпреЛрдкреБрд░", "рд╢рд┐рд╡рдкреБрд░реА", "рд╕реАрдзреА", "рд╕рд┐рдВрдЧрд░реМрд▓реА", "рдЯреАрдХрдордЧрдврд╝", "рдЙрдЬреНрдЬреИрди", "рдЙрдорд░рд┐рдпрд╛", "рд╡рд┐рджрд┐рд╢рд╛", "рдордКрдЧрдВрдЬ"],
    "BR": ["рдЕрд░рд░рд┐рдпрд╛", "рдЕрд░рд╡рд▓", "рдФрд░рдВрдЧрд╛рдмрд╛рдж", "рдмрд╛рдВрдХрд╛", "рдмреЗрдЧреВрд╕рд░рд╛рдп", "рднрд╛рдЧрд▓рдкреБрд░", "рднреЛрдЬрдкреБрд░", "рдмрдХреНрд╕рд░", "рджрд░рднрдВрдЧрд╛", "рдкреВрд░реНрд╡реА рдЪрдВрдкрд╛рд░рдг", "рдЧрдпрд╛", "рдЧреЛрдкрд╛рд▓рдЧрдВрдЬ", "рдЬрдореБрдИ", "рдЬрд╣рд╛рдирд╛рдмрд╛рдж", "рдХреИрдореВрд░", "рдХрдЯрд┐рд╣рд╛рд░", "рдЦрдЧрдбрд╝рд┐рдпрд╛", "рдХрд┐рд╢рдирдЧрдВрдЬ", "рд▓рдЦреАрд╕рд░рд╛рдп", "рдордзреЗрдкреБрд░рд╛", "рдордзреБрдмрдиреА", "рдореБрдВрдЧреЗрд░", "рдореБрдЬрдлреНрдлрд░рдкреБрд░", "рдирд╛рд▓рдВрджрд╛", "рдирд╡рд╛рджрд╛", "рдкрдЯрдирд╛", "рдкреВрд░реНрдгрд┐рдпрд╛", "рд░реЛрд╣рддрд╛рд╕", "рд╕рд╣рд░рд╕рд╛", "рд╕рдорд╕реНрддреАрдкреБрд░", "рд╕рд╛рд░рдг", "рд╢реЗрдЦрдкреБрд░рд╛", "рд╢рд┐рд╡рд╣рд░", "рд╕реАрддрд╛рдордврд╝реА", "рд╕рд┐рд╡рд╛рди", "рд╕реБрдкреМрд▓", "рд╡реИрд╢рд╛рд▓реА", "рдкрд╢реНрдЪрд┐рдореА рдЪрдВрдкрд╛рд░рдг"],
    "CG": ["рдмрд╛рд▓реЛрдж", "рдмрд▓реМрджрд╛рдмрд╛рдЬрд╝рд╛рд░", "рдмрд▓рд░рд╛рдордкреБрд░", "рдмрд╕реНрддрд░", "рдмреЗрдореЗрддрд░рд╛", "рдмреАрдЬрд╛рдкреБрд░", "рдмрд┐рд▓рд╛рд╕рдкреБрд░", "рджрдВрддреЗрд╡рд╛рдбрд╝рд╛", "рдзрдорддрд░реА", "рджреБрд░реНрдЧ", "рдЧрд░рд┐рдпрд╛рдмрдВрдж", "рдЬрд╛рдВрдЬрдЧреАрд░-рдЪрд╛рдВрдкрд╛", "рдЬрд╢рдкреБрд░", "рдХрдмреАрд░рдзрд╛рдо", "рдХрд╛рдВрдХреЗрд░", "рдХреЛрдВрдбрд╛рдЧрд╛рдВрд╡", "рдХреЛрд░рдмрд╛", "рдХреЛрд░рд┐рдпрд╛", "рдорд╣рд╛рд╕рдореБрдВрдж", "рдореБрдВрдЧреЗрд▓реА", "рдирд╛рд░рд╛рдпрдгрдкреБрд░", "рд░рд╛рдпрдЧрдврд╝", "рд░рд╛рдпрдкреБрд░", "рд░рд╛рдЬрдирд╛рдВрджрдЧрд╛рдВрд╡", "рд╕реБрдХрдорд╛", "рд╕реВрд░рдЬрдкреБрд░", "рд╕рд░рдЧреБрдЬрд╛", "рдореЛрд╣рд▓рд╛-рдорд╛рдирдкреБрд░", "рд╕рдХреНрддреА", "рд╕рд╛рд░рдВрдЧрдврд╝-рдмрд┐рд▓рд╛рдИрдЧрдврд╝"],
    "MH": ["рдЕрд╣рдорджрдирдЧрд░", "рдЕрдХреЛрд▓рд╛", "рдЕрдорд░рд╛рд╡рддреА", "рдЫрддреНрд░рдкрддрд┐ рд╕рдВрднрд╛рдЬреАрдирдЧрд░", "рдмреАрдб", "рднрдВрдбрд╛рд░рд╛", "рдмреБрд▓рдврд╛рдгрд╛", "рдЪрдВрджреНрд░рдкреБрд░", "рдзреБрд▓реЗ", "рдЧрдврд╝рдЪрд┐рд░реЛрд▓реА", "рдЧреЛрдВрджрд┐рдпрд╛", "рд╣рд┐рдВрдЧреЛрд▓реА", "рдЬрд▓рдЧрд╛рдВрд╡", "рдЬрд▓рдирд╛", "рдХреЛрд▓реНрд╣рд╛рдкреБрд░", "рд▓рд╛рддреВрд░", "рдореБрдВрдмрдИ", "рдирд╛рдЧрдкреБрд░", "рдирд╛рдВрджреЗрдбрд╝", "рдирд╛рд╕рд┐рдХ", "рдзрд╛рд░рд╛рд╢рд┐рд╡", "рдкрд╛рд▓рдШрд░", "рдкрд░рднрдгреА", "рдкреБрдгреЗ", "рд░рд╛рдпрдЧрдврд╝", "рд░рддреНрдирд╛рдЧрд┐рд░реА", "рд╕рд╛рдВрдЧрд▓реА", "рд╕рд╛рддрд╛рд░рд╛", "рд╕рд┐рдВрдзреБрджреБрд░реНрдЧ", "рд╕реЛрд▓рд╛рдкреБрд░", "рдард╛рдгреЗ", "рд╡рд░реНрдзрд╛", "рд╡рд╛рд╢рд┐рдо", "рдпрд╡рддрдорд╛рд▓"],
    "GJ": ["рдЕрд╣рдорджрд╛рдмрд╛рдж", "рдЕрдорд░реЗрд▓реА", "рдЖрдирдВрдж", "рдЕрд░рд╛рд╡рд▓реА", "рдмрдирд╛рд╕рдХрд╛рдВрдард╛", "рднрд░реВрдЪ", "рднрд╛рд╡рдирдЧрд░", "рдмреЛрдЯрд╛рдж", "рджрд╛рд╣реЛрдж", "рдбрд╛рдВрдЧ", "рджреНрд╡рд╛рд░рдХрд╛", "рдЧрд╛рдВрдзреАрдирдЧрд░", "рдЬрд╛рдордирдЧрд░", "рдЬреВрдирд╛рдЧрдврд╝", "рдХрдЪреНрдЫ", "рдЦреЗрдбрд╝рд╛", "рдореЗрд╣рд╕рд╛рдгрд╛", "рдореЛрд░рдмреА", "рдирд░реНрдорджрд╛", "рдирд╡рд╕рд╛рд░реА", "рдкрдВрдЪрдорд╣рд▓", "рдкрд╛рдЯрди", "рдкреЛрд░рдмрдВрджрд░", "рд░рд╛рдЬрдХреЛрдЯ", "рд╕рд╛рдмрд░рдХрд╛рдВрдард╛", "рд╕реВрд░рдд", "рд╕реБрд░реЗрдВрджреНрд░рдирдЧрд░", "рддрд╛рдкреА", "рд╡рдбреЛрджрд░рд╛", "рд╡рд▓рд╕рд╛рдб"],
    "PB": ["рдЕрдореГрддрд╕рд░", "рдмрд░рдирд╛рд▓рд╛", "рдмрдард┐рдВрдбрд╛", "рдлрд╝рд░реАрджрдХреЛрдЯ", "рдлрд╝рддреЗрд╣рдЧрдврд╝ рд╕рд╛рд╣рд┐рдм", "рдлрд╝рд╛рдЬрд╝рд┐рд▓реНрдХрд╛", "рдлрд╝рд┐рд░реЛрдЬрд╝рдкреБрд░", "рдЧреБрд░рджрд╛рд╕рдкреБрд░", "рд╣реЛрд╢рд┐рдпрд╛рд░рдкреБрд░", "рдЬрд╛рд▓рдВрдзрд░", "рдХрдкреВрд░рдерд▓рд╛", "рд▓реБрдзрд┐рдпрд╛рдирд╛", "рдорд╛рдирд╕рд╛", "рдореЛрдЧрд╛", "рдкрдард╛рдирдХреЛрдЯ", "рдкрдЯрд┐рдпрд╛рд▓рд╛", "рд░реВрдкрдирдЧрд░", "рд╕рдВрдЧрд░реВрд░", "рддрд░рдирддрд╛рд░рди", "рдореЛрд╣рд╛рд▓реА", "рдирд╡рд╛рдВрд╢рд╣рд░"],
    "HR": ["рдЕрдВрдмрд╛рд▓рд╛", "рднрд┐рд╡рд╛рдиреА", "рдлрд░реАрджрд╛рдмрд╛рдж", "рдлрддреЗрд╣рд╛рдмрд╛рдж", "рдЧреБрд░реБрдЧреНрд░рд╛рдо", "рд╣рд┐рд╕рд╛рд░", "рдЭрдЬреНрдЬрд░", "рдЬреАрдВрдб", "рдХреИрдерд▓", "рдХрд░рдирд╛рд▓", "рдХреБрд░реБрдХреНрд╖реЗрддреНрд░", "рдорд╣реЗрдВрджреНрд░рдЧрдврд╝", "рдкрд▓рд╡рд▓", "рдкрдВрдЪрдХреВрд▓рд╛", "рдкрд╛рдиреАрдкрдд", "рд░реЗрд╡рд╛рдбрд╝реА", "рд░реЛрд╣рддрдХ", "рд╕рд┐рд░рд╕рд╛", "рд╕реЛрдиреАрдкрдд", "рдпрдореБрдирд╛рдирдЧрд░"],
    "UK": ["рдЕрд▓реНрдореЛрдбрд╝рд╛", "рдмрд╛рдЧреЗрд╢реНрд╡рд░", "рдЪрдореЛрд▓реА", "рдЪрдВрдкрд╛рд╡рдд", "рджреЗрд╣рд░рд╛рджреВрди", "рд╣рд░рд┐рджреНрд╡рд╛рд░", "рдиреИрдиреАрддрд╛рд▓", "рдкреМрдбрд╝реА", "рдкрд┐рдереМрд░рд╛рдЧрдврд╝", "рд░реБрджреНрд░рдкреНрд░рдпрд╛рдЧ", "рдЯрд┐рд╣рд░реА", "рдЙрдзрдо рд╕рд┐рдВрд╣ рдирдЧрд░", "рдЙрддреНрддрд░рдХрд╛рд╢реА"]
};

// --- 3. HELPER FUNCTIONS ---

function resetBelow(level) {
    if(level <= 1) { 
        document.getElementById('sDist').classList.add('hidden'); 
        document.getElementById('sDist').innerHTML = ''; 
    }
    if(level <= 2) { 
        document.getElementById('box-panchayat').classList.add('hidden'); 
        document.getElementById('newPanchayat').classList.add('hidden'); 
    }
    if(level <= 3) { 
        document.getElementById('box-gaon').classList.add('hidden'); 
        document.getElementById('newGaon').classList.add('hidden'); 
    }
}

// --- 4. CORE LOGIC ---

function loadDistricts() {
    const s = document.getElementById('sState').value;
    resetBelow(1);
    const ds = document.getElementById('sDist');
    if(s && distData[s]) {
        ds.innerHTML = '<option value="">-- рдЬрд┐рд▓рд╛ рдЪреБрдиреЗрдВ --</option>';
        distData[s].forEach(d => ds.innerHTML += `<option value="${d}">${d}</option>`);
        ds.classList.remove('hidden');
    }
}

function fetchPanchayats() {
    const state = document.getElementById('sState').value;
    const dist = document.getElementById('sDist').value;
    resetBelow(2);
    if(!dist) return;

    const ps = document.getElementById('sPanchayat');
    ps.innerHTML = '<option value="">-- рдкрдВрдЪрд╛рдпрдд рдЪреБрдиреЗрдВ --</option><option value="NEW">+ рдирдИ рдкрдВрдЪрд╛рдпрдд рдЬреЛреЬреЗрдВ</option>';
    document.getElementById('box-panchayat').classList.remove('hidden');

    db.ref(`v2_chain/${state}/${dist}`).once('value', (snap) => {
        if(snap.exists()) snap.forEach(c => ps.innerHTML += `<option value="${c.key}">${c.key}</option>`);
    });
}

function togglePInput() {
    const val = document.getElementById('sPanchayat').value;
    document.getElementById('newPanchayat').classList.toggle('hidden', val !== 'NEW');
    resetBelow(3);
}

function fetchVillages() {
    const state = document.getElementById('sState').value;
    const dist = document.getElementById('sDist').value;
    let pan = document.getElementById('sPanchayat').value === 'NEW' ? document.getElementById('newPanchayat').value.trim() : document.getElementById('sPanchayat').value;
    
    if(!pan) return alert("рдкрдВрдЪрд╛рдпрдд рдХрд╛ рдирд╛рдо рдЪреБрдиреЗрдВ рдпрд╛ рд▓рд┐рдЦреЗрдВ");
    resetBelow(3);

    const gs = document.getElementById('sGaon');
    gs.innerHTML = '<option value="">-- рдЧрд╛рдБрд╡ рдЪреБрдиреЗрдВ --</option><option value="NEW">+ рдирдпрд╛ рдЧрд╛рдБрд╡ рдЬреЛреЬреЗрдВ</option>';
    document.getElementById('box-gaon').classList.remove('hidden');

    db.ref(`v2_chain/${state}/${dist}/${pan}`).once('value', (snap) => {
        if(snap.exists()) snap.forEach(c => gs.innerHTML += `<option value="${c.key}">${c.key}</option>`);
    });
}

function toggleGInput() {
    document.getElementById('newGaon').classList.toggle('hidden', document.getElementById('sGaon').value !== 'NEW');
}

function enterPortal() {
    const gaon = document.getElementById('sGaon').value === 'NEW' ? document.getElementById('newGaon').value.trim() : document.getElementById('sGaon').value;
    if(!gaon) return alert("рдЧрд╛рдБрд╡ рдХрд╛ рдирд╛рдо рдЪреБрдиреЗрдВ рдпрд╛ рд▓рд┐рдЦреЗрдВ");

    document.getElementById('section-location').classList.add('hidden');
    document.getElementById('section-portal').classList.remove('hidden');
    switchMode('worker');
}

function switchMode(mode) {
    const isW = mode === 'worker';
    document.getElementById('mode-worker').classList.toggle('hidden', !isW);
    document.getElementById('mode-customer').classList.toggle('hidden', isW);
    document.getElementById('tabW').className = isW ? 'tab-btn active-tab' : 'tab-btn bg-white';
    document.getElementById('tabC').className = isW ? 'tab-btn bg-white' : 'tab-btn active-tab';
    if(!isW) loadList();
}

function saveWorker() {
    const state = document.getElementById('sState').value;
    const dist = document.getElementById('sDist').value;
    const pan = document.getElementById('sPanchayat').value === 'NEW' ? document.getElementById('newPanchayat').value.trim() : document.getElementById('sPanchayat').value;
    const gaon = document.getElementById('sGaon').value === 'NEW' ? document.getElementById('newGaon').value.trim() : document.getElementById('sGaon').value;
    
    const name = document.getElementById('wName').value.trim();
    const skill = document.getElementById('wSkill').value;
    const phone = document.getElementById('wPhone').value.trim();

    if(!name || !skill || phone.length < 10) return alert("рдХреГрдкрдпрд╛ рдирд╛рдо, рдХрд╛рдо рдФрд░ 10 рдЕрдВрдХреЛрдВ рдХрд╛ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рд╕рд╣реА рднрд░реЗрдВ");

    const btn = document.getElementById('saveBtn');
    btn.disabled = true;
    btn.innerText = "рд╕реЗрд╡ рд╣реЛ рд░рд╣рд╛ рд╣реИ...";

    db.ref(`v2_chain/${state}/${dist}/${pan}/${gaon}/workers`).push({
        name: name,
        skill: skill,
        phone: phone,
        timestamp: Date.now()
    }).then(() => {
        alert("рдЖрдкрдХрд╛ рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рд╕рдлрд▓ рд░рд╣рд╛!");
        document.getElementById('wName').value = '';
        document.getElementById('wPhone').value = '';
        btn.disabled = false;
        btn.innerText = "рдирд╛рдо рдЬреЛреЬреЗрдВ тЬЕ";
        switchMode('customer');
    }).catch(err => {
        alert("Error: " + err.message);
        btn.disabled = false;
    });
}

function loadList() {
    const state = document.getElementById('sState').value;
    const dist = document.getElementById('sDist').value;
    const pan = document.getElementById('sPanchayat').value === 'NEW' ? document.getElementById('newPanchayat').value.trim() : document.getElementById('sPanchayat').value;
    const gaon = document.getElementById('sGaon').value === 'NEW' ? document.getElementById('newGaon').value.trim() : document.getElementById('sGaon').value;
    
    const listDiv = document.getElementById('worker-list');
    listDiv.innerHTML = "<p class='text-center p-4'>рдЦреЛрдЬ рд░рд╣реЗ рд╣реИрдВ...</p>";

    db.ref(`v2_chain/${state}/${dist}/${pan}/${gaon}/workers`).on('value', (snap) => {
        listDiv.innerHTML = "";
        if(snap.exists()) {
            snap.forEach(c => {
                const w = c.val();
                listDiv.innerHTML += `
                    <div class="worker-card">
                        <h4 class="text-xl font-bold">${w.name}</h4>
                        <p class="text-orange-600 font-bold text-sm uppercase">${w.skill}</p>
                        <a href="tel:${w.phone}" class="inline-block mt-2 font-bold text-blue-600 border border-blue-600 px-4 py-1 rounded-lg">ЁЯУЮ рдХреЙрд▓ рдХрд░реЗрдВ: ${w.phone}</a>
                    </div>`;
            });
        } else {
            listDiv.innerHTML = "<p class='text-center text-gray-400 p-10'>рдЗрд╕ рдЧрд╛рдБрд╡ рдореЗрдВ рдЕрднреА рдХреЛрдИ рд╡рд░реНрдХрд░ рдирд╣реАрдВ рд╣реИред</p>";
        }
    });
}
