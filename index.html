<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gram Shakti</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#2e7d32;color:#fff;padding:15px;text-align:center;font-size:20px}
.container{padding:15px}
.card{background:#fff;padding:15px;margin-bottom:10px;border-radius:8px;cursor:pointer}
.hidden{display:none}
button,input,select{width:100%;padding:10px;margin-top:10px}
button{background:#2e7d32;color:#fff;border:none}
.call{background:#0d47a1}
</style>
</head>

<body>

<header>GRAM SHAKTI</header>

<div class="container" id="locationBox">
  <h3>рдЧрд╛рдБрд╡ рдЪреБрдиреЗрдВ</h3>
  <div id="villageList"></div>
</div>

<div class="container hidden" id="villageHome">
  <h3 id="villageTitle"></h3>

  <div class="card" onclick="openCategory('рджреВрдз')">ЁЯеЫ рджреВрдз</div>
  <div class="card" onclick="openCategory('рдкрд╛рдиреА')">ЁЯЪ░ рдкрд╛рдиреА</div>
  <div class="card" onclick="openCategory('рдордЬрджреВрд░')">ЁЯС╖ рдордЬрджреВрд░</div>
  <div class="card" onclick="openCategory('рдкреНрд▓рдВрдмрд░')">ЁЯФз рдкреНрд▓рдВрдмрд░</div>
  <div class="card" onclick="openCategory('JCB')">ЁЯЪЬ JCB</div>

  <div class="card" onclick="openRegister()">ЁЯУЭ рдореИрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реВрдБ</div>
</div>

<div class="container hidden" id="categoryBox">
  <h3 id="catTitle"></h3>
  <div id="catList"></div>
</div>

<div class="container hidden" id="registerBox">
  <h3>рд╕реЗрд╡рд╛ рдкрдВрдЬреАрдХрд░рдг</h3>
  <input id="rName" placeholder="рдкреВрд░рд╛ рдирд╛рдо">
  <input id="rMobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░">
  <select id="rCat">
    <option>рджреВрдз</option>
    <option>рдкрд╛рдиреА</option>
    <option>рдордЬрджреВрд░</option>
    <option>рдкреНрд▓рдВрдмрд░</option>
    <option>JCB</option>
  </select>
  <button onclick="saveWorker()">Register</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentVillage = null;

// Load saved village (user)
function checkUser() {
  const mobile = prompt("рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рдбрд╛рд▓реЗрдВ");
  db.collection("users").doc(mobile).get().then(doc=>{
    if(doc.exists){
      currentVillage = doc.data().village;
      showVillage(currentVillage);
    }else{
      loadVillages(mobile);
    }
  });
}

function loadVillages(mobile){
  db.collection("villages").get().then(snap=>{
    const box=document.getElementById("villageList");
    box.innerHTML="";
    snap.forEach(d=>{
      const v=d.data().village;
      box.innerHTML+=`<div class="card" onclick="selectVillage('${v}','${mobile}')">${v}</div>`;
    });
  });
}

function selectVillage(v,mobile){
  db.collection("users").doc(mobile).set({village:v});
  showVillage(v);
}

function showVillage(v){
  document.getElementById("locationBox").classList.add("hidden");
  document.getElementById("villageHome").classList.remove("hidden");
  document.getElementById("villageTitle").innerText="ЁЯУН "+v;
  currentVillage=v;
}

function openCategory(cat){
  document.getElementById("villageHome").classList.add("hidden");
  document.getElementById("categoryBox").classList.remove("hidden");
  document.getElementById("catTitle").innerText=cat;

  const list=document.getElementById("catList");
  list.innerHTML="";

  db.collection("workers")
    .where("category","==",cat)
    .where("village","==",currentVillage)
    .get().then(snap=>{
      if(snap.empty){list.innerHTML="рдХреЛрдИ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ";return;}
      snap.forEach(d=>{
        const w=d.data();
        list.innerHTML+=`
        <div class="card">
          <b>${w.name}</b><br>
          ${w.mobile}
          <a href="tel:${w.mobile}">
            <button class="call">ЁЯУЮ Call</button>
          </a>
        </div>`;
      });
    });
}

function openRegister(){
  document.getElementById("villageHome").classList.add("hidden");
  document.getElementById("registerBox").classList.remove("hidden");
}

function saveWorker(){
  db.collection("workers").add({
    name:rName.value,
    mobile:rMobile.value,
    category:rCat.value,
    village:currentVillage
  }).then(()=>{
    alert("рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рд╕рдлрд▓");
    location.reload();
  });
}

checkUser();
</script>

</body>
</html>
