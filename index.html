<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gram Shakti | Fixed Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  body { 
    background: linear-gradient(to bottom right, #fdf4eb, #fffde7, #e0f2fe);
    font-family: 'Noto Sans Devanagari', 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .app-card {
    background: white;
    width: 100%;
    max-width: 480px;
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 15px 30px rgba(0,0,0,0.1);
  }
  .input-field {
    width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #e0e0e0;
    margin-top: 10px; outline: none; font-size: 16px;
  }
  .btn-primary {
    width: 100%; padding: 16px; background: linear-gradient(90deg, #f97316, #ea580c);
    color: white; border-radius: 14px; font-size: 18px; font-weight: 700;
    margin-top: 25px; cursor: pointer; box-shadow: 0 8px 20px rgba(249, 115, 22, 0.4);
  }
  .state-grid-item {
    background: #fff; border: 1px solid #f97316; color: #f97316;
    padding: 15px; border-radius: 12px; text-align: center; font-weight: 600; cursor: pointer;
  }
  /* Neela G Logo Fix */
  #adminLogo {
    background: #2563eb; color: white; width: 48px; height: 48px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 24px; font-weight: bold; cursor: pointer; 
    user-select: none; -webkit-user-select: none;
    touch-action: manipulation; box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
  }
  .header-logo { font-family: 'Poppins', sans-serif; font-weight: 700; color: #f97316; font-size: 2.2rem; }
</style>
</head>
<body>

<div id="app-container" class="app-card"></div>

<div id="msgBox" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
  <div id="msgContent" class="bg-white p-8 rounded-3xl text-center w-full max-w-xs shadow-2xl"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
  projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userFlow = { state: "", district: "", panchayat: "", village: "" };

function showStates() {
  const states = ['Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand', 'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur', 'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura', 'Uttar Pradesh', 'Uttarakhand', 'West Bengal'];
  
  let html = `
    <div class="flex items-center justify-between mb-8">
      <div id="adminLogo">G</div>
      <h1 class="header-logo">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
      <div class="w-12"></div>
    </div>
    <div class="grid grid-cols-2 gap-4 h-[350px] overflow-y-auto pr-2">`;
  states.forEach(s => { html += `<div class="state-grid-item" onclick="userFlow.state='${s}'; showDistrictStep()">${s}</div>`; });
  document.getElementById("app-container").innerHTML = html + `</div>`;
  
  // ADMIN HOLD LOGIC (FIXED)
  const logo = document.getElementById("adminLogo");
  let timer;

  const start = (e) => {
    e.preventDefault();
    timer = setTimeout(() => {
      let p = prompt("Master Password:");
      if(p === "Vikas0627.") showAdminPanel();
    }, 3000);
  };
  const end = () => clearTimeout(timer);

  logo.addEventListener("mousedown", start);
  logo.addEventListener("touchstart", start);
  logo.addEventListener("mouseup", end);
  logo.addEventListener("mouseleave", end);
  logo.addEventListener("touchend", end);
}

function showDistrictStep() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <h2 class="text-xl font-semibold mb-2">‡§ú‡§ø‡§≤‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2>
    <input id="distInp" class="input-field" placeholder="‡§ú‡§ø‡§≤‡§æ...">
    <button onclick="userFlow.district=document.getElementById('distInp').value; showPanchayatStep()" class="btn-primary">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
  `;
}

function showPanchayatStep() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <input id="panchInp" class="input-field" placeholder="‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§≤‡§ø‡§ñ‡•á‡§Ç...">
    <button onclick="userFlow.panchayat=document.getElementById('panchInp').value; showVillageStep()" class="btn-primary">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
  `;
}

function showVillageStep() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <input id="villInp" class="input-field" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§≤‡§ø‡§ñ‡•á‡§Ç...">
    <button onclick="userFlow.village=document.getElementById('villInp').value; showOptions()" class="btn-primary">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

function showOptions() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
    <button onclick="showRegistration()" class="btn-primary">ü§ù ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</button>
    <button onclick="showCustomerView()" class="btn-primary !bg-white !text-f97316 border border-f97316 mt-4">üîç ‡§∏‡•á‡§µ‡§æ ‡§¢‡•Ç‡§Ç‡§¢‡•á‡§Ç</button>
  `;
}

function showRegistration() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</h1>
    <input id="wname" class="input-field" placeholder="‡§®‡§æ‡§Æ">
    <input id="wphone" class="input-field" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤">
    <select id="wwork" class="input-field">
      <option value="">‡§ï‡§æ‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç</option>
      <option>JCB Operator</option><option>‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option><option>‡§Æ‡§ú‡§¶‡•Ç‡§∞</option>
    </select>
    <button onclick="saveWorker()" class="btn-primary">‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
  `;
}

function saveWorker() {
  const n = document.getElementById("wname").value;
  const p = document.getElementById("wphone").value;
  const w = document.getElementById("wwork").value;
  db.ref("workers").push({
    name: n, phone: p, work: w,
    location: `${userFlow.state}/${userFlow.district}/${userFlow.panchayat}/${userFlow.village}`
  }).then(() => { alert("‡§∏‡§´‡§≤!"); showOptions(); });
}

function showCustomerView() {
  document.getElementById("app-container").innerHTML = `
    <h1 class="header-logo text-center mb-6">‡§∏‡•á‡§µ‡§æ‡§è‡§Ç</h1>
    <div id="workerList" class="space-y-4"></div>
    <button onclick="showOptions()" class="mt-6 underline text-gray-400 w-full text-center">‡§™‡•Ä‡§õ‡•á ‡§ú‡§æ‡§è‡§Å</button>
  `;
  const currentPath = `${userFlow.state}/${userFlow.district}/${userFlow.panchayat}/${userFlow.village}`;
  db.ref("workers").on("value", (snap) => {
    let html = "";
    snap.forEach(c => {
      const w = c.val();
      if(w.location === currentPath) {
        html += `<div class="p-4 border rounded-xl flex justify-between items-center shadow-sm">
                   <div><p class="font-bold">${w.name}</p><p class="text-sm text-f97316">${w.work}</p></div>
                   <a href="tel:${w.phone}" class="bg-green-500 text-white p-2 rounded-full">üìû</a>
                 </div>`;
      }
    });
    document.getElementById("workerList").innerHTML = html || "‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ";
  });
}

function showAdminPanel() {
  document.getElementById("app-container").innerHTML = `
    <div class="flex justify-between items-center mb-6 border-b pb-2">
      <h2 class="text-2xl font-bold text-red-600">Admin</h2>
      <button onclick="location.reload()" class="text-sm bg-gray-100 px-2 py-1 rounded">Logout</button>
    </div>
    <div id="adminList" class="space-y-4 h-[400px] overflow-y-auto"></div>
  `;
  db.ref("workers").on("value", (snap) => {
    let html = "";
    snap.forEach(c => {
      const data = c.val();
      html += `<div class="p-3 border rounded shadow-sm flex justify-between items-center">
                 <p class="text-sm font-bold">${data.name}</p>
                 <button onclick="db.ref('workers/${c.key}').remove()" class="bg-red-500 text-white px-2 py-1 rounded text-xs">Delete</button>
               </div>`;
    });
    document.getElementById("adminList").innerHTML = html || "‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à";
  });
}

showStates();
</script>
</body>
</html>
