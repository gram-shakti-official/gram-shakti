<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø - ‡§ó‡§æ‡§Å‡§µ ‡§ï‡•Ä ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∏‡•á‡§µ‡§æ</title>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { 
            font-family: 'Noto Sans Devanagari', sans-serif;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), 
                        url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=1200&q=80');
            background-size: cover; background-attachment: fixed;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px;
        }
        .app-card {
            background: rgba(255, 255, 255, 0.95); width: 100%; max-width: 480px; 
            padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
        }
        .btn-main {
            width: 100%; padding: 16px; background: #f97316; color: white; 
            border-radius: 14px; font-size: 18px; font-weight: 700; cursor: pointer;
            margin-top: 12px; transition: 0.3s; border: none;
        }
        .btn-main:active { transform: scale(0.98); }
        input, select { 
            width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 12px; 
            border: 1px solid #ddd; font-size: 16px;
        }
        .back-btn {
            position: fixed; top: 15px; left: 15px; background: #2563eb; color: white;
            padding: 8px 18px; border-radius: 20px; font-weight: bold; cursor: pointer; z-index: 100;
        }
        .list-item {
            background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px;
            border-left: 6px solid #f97316; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<button class="back-btn" id="backBtn" style="display:none;" onclick="location.reload()">‚Üê ‡§µ‡§æ‡§™‡§∏</button>

<div class="app-card" id="main-container">
    <div id="home-content">
        <h1 style="color:#f97316; text-align:center; font-size:35px; font-weight:bold; margin-bottom:5px;">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø</h1>
        <p style="text-align:center; color:#555; margin-bottom:25px;">‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§π‡•Å‡§®‡§∞, ‡§∂‡§π‡§∞ ‡§ï‡§æ ‡§¨‡§æ‡§ú‡§º‡§æ‡§∞</p>
        
        <button class="btn-main" onclick="showStateSelection()">üîé ‡§∏‡•á‡§µ‡§æ ‡§Ø‡§æ ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ñ‡•ã‡§ú‡•á‡§Ç</button>
        <button class="btn-main" style="background:#1a1a1a;" onclick="showRegistration()">üì¢ ‡§Ö‡§™‡§®‡§æ ‡§ï‡§æ‡§Æ/‡§¶‡•Å‡§ï‡§æ‡§® ‡§ú‡•ã‡•ú‡•á‡§Ç</button>

        <div style="margin-top:40px; padding:15px; background:#f0f9ff; border-radius:15px; text-align:center; border:1px solid #bae6fd;">
            <p style="font-size:14px; color:#0369a1; font-weight:bold; margin-bottom:10px;">‡§Æ‡§¶‡§¶ ‡§Ø‡§æ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç</p>
            <button onclick="contactAdmin()" style="background:#25d366; color:white; width:100%; padding:12px; border-radius:10px; font-weight:bold; border:none; cursor:pointer;">
                üí¨ ‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§Æ‡•á‡§∏‡•á‡§ú ‡§≠‡•á‡§ú‡•á‡§Ç
            </button>
        </div>
    </div>
</div>

<script>
// 1. Firebase ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®
const firebaseConfig = {
    apiKey: "AIzaSyCuvev3-jwZwQuO_fHYyv2E2ovLny4Lh8Q",
    authDomain: "gram-shakti-b135a.firebaseapp.com",
    databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com",
    projectId: "gram-shakti-b135a"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let userFlow = { state: '', jila: '', village: '', service: '' };

// 2. ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® (‡§®‡§Ç‡§¨‡§∞ 9784499059 ‡§Ø‡§π‡§æ‡§Å ‡§π‡•à)
function contactAdmin() {
    const p = "919784499059";
    const m = "‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§∞‡§µ‡§ø ‡§≠‡§æ‡§à, ‡§Æ‡•à‡§Ç ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø ‡§ê‡§™ ‡§∏‡•á ‡§Ü‡§Ø‡§æ ‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§Æ‡•Å‡§ù‡•á ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§";
    window.open(`https://wa.me/${p}?text=${encodeURIComponent(m)}`, '_blank');
}

// 3. ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡§Ø‡§®
function showStateSelection() {
    document.getElementById('backBtn').style.display = 'block';
    const states = ['Uttar Pradesh', 'Bihar', 'Rajasthan', 'Madhya Pradesh', 'Haryana'];
    let html = `<h2 class="text-xl font-bold mb-4">‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç:</h2>`;
    states.forEach(s => {
        html += `<button class="btn-main" style="background:#333; margin-bottom:8px;" onclick="userFlow.state='${s}'; showLocationInput()">${s}</button>`;
    });
    document.getElementById('main-container').innerHTML = html;
}

// 4. ‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§á‡§®‡§™‡•Å‡§ü (‡§∂‡§π‡§∞/‡§ó‡§æ‡§Å‡§µ)
function showLocationInput() {
    document.getElementById('main-container').innerHTML = `
        <h2 class="text-xl font-bold mb-2">${userFlow.state}</h2>
        <p class="mb-4 text-gray-600">‡§Ö‡§™‡§®‡§æ ‡§ú‡§ø‡§≤‡§æ ‡§î‡§∞ ‡§ó‡§æ‡§Å‡§µ/‡§∂‡§π‡§∞ ‡§≠‡§∞‡•á‡§Ç:</p>
        <input type="text" id="jila" placeholder="‡§ú‡§ø‡§≤‡§æ (‡§ú‡•à‡§∏‡•á: ‡§ú‡§Ø‡§™‡•Å‡§∞)">
        <input type="text" id="gaov" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§Ø‡§æ ‡§∂‡§π‡§∞ (‡§ú‡•à‡§∏‡•á: ‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞‡§æ)">
        <button class="btn-main" onclick="saveLoc()">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>
    `;
}

function saveLoc() {
    userFlow.jila = document.getElementById('jila').value;
    userFlow.village = document.getElementById('gaov').value;
    if(!userFlow.jila || !userFlow.village) return alert("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");
    showCategorySelection();
}

// 5. ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ö‡•Å‡§®‡§æ‡§µ
function showCategorySelection() {
    const cats = ['‡§ï‡§ø‡§∞‡§æ‡§®‡§æ/‡§¶‡•Å‡§ï‡§æ‡§®', '‡§°‡•á‡§Ø‡§∞‡•Ä/‡§¶‡•Ç‡§ß', '‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä/‡§µ‡§∞‡•ç‡§ï‡§∞', '‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞/‡§ó‡§æ‡•ú‡•Ä', 'JCB/‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞'];
    let html = `<h2 class="text-xl font-bold mb-4">‡§ï‡•ç‡§Ø‡§æ ‡§¢‡•Ç‡§Å‡§¢ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?</h2>`;
    cats.forEach(c => {
        html += `<button class="btn-main" style="background:white; color:#333; border:1px solid #ddd;" onclick="userFlow.service='${c}'; fetchResults()">${c}</button>`;
    });
    document.getElementById('main-container').innerHTML = html;
}

// 6. ‡§∞‡§ø‡§ú‡§≤‡•ç‡§ü‡•ç‡§∏ (‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§•)
function fetchResults() {
    document.getElementById('main-container').innerHTML = `<h2 class="font-bold mb-4">${userFlow.service} ‡§≤‡§ø‡§∏‡•ç‡§ü</h2><div id="result-list">‡§ñ‡•ã‡§ú ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>`;
    
    db.ref('users/').once('value', snap => {
        let html = "";
        let found = false;
        snap.forEach(child => {
            let d = child.val();
            // ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞: ‡§Ö‡§ó‡§∞ ‡§ó‡§æ‡§Å‡§µ ‡§Æ‡•à‡§ö ‡§π‡•ã ‡§Ø‡§æ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§∂‡§π‡§∞ ‡§ú‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•ã
            if(d.service === userFlow.service && (d.village === userFlow.village || d.workArea === 'city')) {
                html += `
                    <div class="list-item">
                        <div class="flex justify-between items-start">
                            <div>
                                <b class="text-lg">${d.name || d.workerName}</b><br>
                                <span class="text-sm text-gray-500">${d.village} (${d.jila})</span>
                            </div>
                            <a href="tel:${d.phone}" class="bg-green-600 text-white p-3 rounded-full">üìû</a>
                        </div>
                        <div class="mt-2 text-sm">
                            ${d.canDeliver ? 'üöö ‡§π‡•ã‡§Æ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß' : 'üè† ‡§¶‡•Å‡§ï‡§æ‡§® ‡§™‡§∞ ‡§∏‡•á‡§µ‡§æ'}
                        </div>
                    </div>`;
                found = true;
            }
        });
        document.getElementById('result-list').innerHTML = found ? html : "‡§Æ‡§æ‡•û ‡§ï‡§∞‡•á‡§Ç, ‡§á‡§∏ ‡§ú‡§ó‡§π ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§";
    });
}

// 7. ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•á‡§∂‡§® (‡§®‡§Ø‡§æ ‡§ï‡§æ‡§Æ ‡§ú‡•ã‡•ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è)
function showRegistration() {
    document.getElementById('backBtn').style.display = 'block';
    document.getElementById('main-container').innerHTML = `
        <h2 class="text-xl font-bold mb-4">‡§Ö‡§™‡§®‡§æ ‡§ï‡§æ‡§Æ ‡§ú‡•ã‡•ú‡•á‡§Ç</h2>
        <input type="text" id="regName" placeholder="‡§Ü‡§™‡§ï‡§æ/‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ">
        <input type="tel" id="regPhone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
        <input type="text" id="regGaov" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§Ø‡§æ ‡§∂‡§π‡§∞">
        <select id="regService">
            <option>‡§ï‡§ø‡§∞‡§æ‡§®‡§æ/‡§¶‡•Å‡§ï‡§æ‡§®</option><option>‡§°‡•á‡§Ø‡§∞‡•Ä/‡§¶‡•Ç‡§ß</option>
            <option>‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä/‡§µ‡§∞‡•ç‡§ï‡§∞</option><option>‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞/‡§ó‡§æ‡•ú‡•Ä</option>
        </select>
        <p class="text-sm mt-2">‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç?</p>
        <select id="regDel"><option value="false">‡§®‡§π‡•Ä‡§Ç</option><option value="true">‡§π‡§æ‡§Å</option></select>
        <button class="btn-main" onclick="registerWorker()">‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç</button>
    `;
}

function registerWorker() {
    let data = {
        name: document.getElementById('regName').value,
        phone: document.getElementById('regPhone').value,
        village: document.getElementById('regGaov').value,
        service: document.getElementById('regService').value,
        canDeliver: document.getElementById('regDel').value === 'true',
        timestamp: Date.now()
    };
    if(!data.name || !data.phone) return alert("‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§≠‡§∞‡•á‡§Ç");
    db.ref('users/').push(data).then(() => {
        alert("‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§Ü‡§™ ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∂‡§ï‡•ç‡§§‡§ø ‡§∏‡•á ‡§ú‡•Å‡•ú ‡§ö‡•Å‡§ï‡•á ‡§π‡•à‡§Ç‡•§");
        location.reload();
    });
}
</script>
</body>
</html>
