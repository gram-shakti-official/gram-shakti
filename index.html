<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ग्राम शक्ति</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body class="bg-gray-100">

<!-- ================= HEADER ================= -->
<header class="text-center p-6 bg-white shadow">
  <h1 class="text-4xl font-black text-orange-600">ग्राम शक्ति</h1>
  <p class="text-xs text-gray-400 tracking-widest">NATIONAL VILLAGE CHAIN NETWORK</p>
</header>

<!-- ================= MAIN ================= -->
<main class="max-w-md mx-auto p-4">

<!-- ========== STATE ========== -->
<div id="stateBox">
  <h2 class="font-bold mb-2">राज्य चुनें</h2>
  <select id="state" class="w-full p-3 rounded" onchange="loadDistricts()">
    <option value="">-- राज्य --</option>
    <option>Uttar Pradesh</option>
    <option>Bihar</option>
    <option>Madhya Pradesh</option>
    <option>Rajasthan</option>
    <option>Punjab</option>
    <option>Haryana</option>
  </select>
</div>

<!-- ========== DISTRICT ========== -->
<div id="districtBox" class="hidden mt-4">
  <h2 class="font-bold mb-2">जिला चुनें</h2>
  <select id="district" class="w-full p-3 rounded" onchange="loadPanchayat()"></select>
</div>

<!-- ========== PANCHAYAT ========== -->
<div id="panchayatBox" class="hidden mt-4">
  <h2 class="font-bold mb-2">पंचायत</h2>
  <select id="panchayat" class="w-full p-3 rounded" onchange="togglePanchayat()">
    <option value="NEW">+ नई पंचायत</option>
  </select>
  <input id="newPanchayat" class="w-full p-3 mt-2 rounded hidden" placeholder="पंचायत नाम">
  <button onclick="loadVillage()" class="w-full bg-orange-500 text-white p-3 mt-2 rounded">
    आगे
  </button>
</div>

<!-- ========== VILLAGE ========== -->
<div id="villageBox" class="hidden mt-4">
  <h2 class="font-bold mb-2">गाँव</h2>
  <select id="village" class="w-full p-3 rounded" onchange="toggleVillage()">
    <option value="NEW">+ नया गाँव</option>
  </select>
  <input id="newVillage" class="w-full p-3 mt-2 rounded hidden" placeholder="गाँव नाम">
  <button onclick="openPortal()" class="w-full bg-blue-600 text-white p-3 mt-2 rounded">
    Portal खोलें
  </button>
</div>

<!-- ========== PORTAL ========== -->
<div id="portalBox" class="hidden mt-6">

<div class="flex gap-2 mb-4">
  <button onclick="showWorker()" class="flex-1 bg-orange-500 text-white p-2 rounded">Worker</button>
  <button onclick="showCustomer()" class="flex-1 bg-gray-300 p-2 rounded">Customer</button>
</div>

<!-- WORKER -->
<div id="workerBox">
  <input id="wName" placeholder="नाम" class="w-full p-2 rounded mb-2">
  <input id="wSkill" placeholder="काम" class="w-full p-2 rounded mb-2">
  <input id="wPhone" placeholder="मोबाइल" class="w-full p-2 rounded mb-2">
  <button onclick="saveWorker()" class="w-full bg-green-600 text-white p-2 rounded">
    Save Worker
  </button>
</div>

<!-- CUSTOMER -->
<div id="customerBox" class="hidden">
  <div id="workerList" class="mt-2"></div>
</div>

</div>

</main>

<script>
/* ========== FIREBASE CONFIG ========== */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  databaseURL: "YOUR_DATABASE_URL",
  projectId: "YOUR_PROJECT_ID"
});
const db = firebase.database();

/* ========== STATE → DISTRICT ========== */
function loadDistricts() {
  let s = state.value;
  district.innerHTML = "<option>-- जिला --</option>";
  db.ref(`india/${s}/districts`).once("value", snap => {
    snap.forEach(d => {
      district.innerHTML += `<option>${d.key}</option>`;
    });
    districtBox.classList.remove("hidden");
  });
}

/* ========== DISTRICT → PANCHAYAT ========== */
function loadPanchayat() {
  panchayat.innerHTML = `<option value="NEW">+ नई पंचायत</option>`;
  db.ref(`india/${state.value}/districts/${district.value}/panchayats`)
  .once("value", snap => {
    snap.forEach(p => {
      panchayat.innerHTML += `<option>${p.key}</option>`;
    });
    panchayatBox.classList.remove("hidden");
  });
}
function togglePanchayat() {
  newPanchayat.classList.toggle("hidden", panchayat.value !== "NEW");
}

/* ========== PANCHAYAT → VILLAGE ========== */
function loadVillage() {
  let p = panchayat.value === "NEW" ? newPanchayat.value : panchayat.value;
  if(!p) return alert("पंचायत नाम लिखें");
  village.innerHTML = `<option value="NEW">+ नया गाँव</option>`;
  db.ref(`india/${state.value}/districts/${district.value}/panchayats/${p}/villages`)
  .once("value", snap => {
    snap.forEach(v => {
      village.innerHTML += `<option>${v.key}</option>`;
    });
    villageBox.classList.remove("hidden");
  });
}
function toggleVillage() {
  newVillage.classList.toggle("hidden", village.value !== "NEW");
}

/* ========== PORTAL ========== */
function openPortal() {
  portalBox.classList.remove("hidden");
  showWorker();
}
function showWorker(){
  workerBox.classList.remove("hidden");
  customerBox.classList.add("hidden");
}
function showCustomer(){
  workerBox.classList.add("hidden");
  customerBox.classList.remove("hidden");
  loadWorkers();
}

/* ========== SAVE WORKER ========== */
function saveWorker(){
  let p = panchayat.value==="NEW"?newPanchayat.value:panchayat.value;
  let v = village.value==="NEW"?newVillage.value:village.value;
  db.ref(`india/${state.value}/districts/${district.value}/panchayats/${p}/villages/${v}/workers`)
  .push({
    name:wName.value,
    skill:wSkill.value,
    phone:wPhone.value
  });
  alert("Worker Saved");
}

/* ========== LOAD WORKERS ========== */
function loadWorkers(){
  let p = panchayat.value==="NEW"?newPanchayat.value:panchayat.value;
  let v = village.value==="NEW"?newVillage.value:village.value;
  workerList.innerHTML="";
  db.ref(`india/${state.value}/districts/${district.value}/panchayats/${p}/villages/${v}/workers`)
  .once("value", snap=>{
    snap.forEach(w=>{
      let d=w.val();
      workerList.innerHTML+=`
        <div class="bg-white p-2 rounded shadow mb-2">
          <b>${d.name}</b><br>${d.skill}<br>
          <a href="tel:${d.phone}" class="text-blue-600">${d.phone}</a>
        </div>`;
    });
  });
}
</script>

</body>
</html>
