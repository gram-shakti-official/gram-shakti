<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gram Shakti | Final Master App</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Hind', sans-serif; background-color: #f8fafc; }
        .state-card { height: 100px; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: 16px; color: white; font-weight: 700; transition: 0.3s; text-align: center; padding: 10px; font-size: 14px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .g1 { background: linear-gradient(135deg, #FF512F, #DD2476); }
        .g2 { background: linear-gradient(135deg, #4776E6, #8E54E9); }
        .g3 { background: linear-gradient(135deg, #00b09b, #96c93d); }
        .g4 { background: linear-gradient(135deg, #f857a6, #ff5858); }
        .g5 { background: linear-gradient(135deg, #1D2671, #C33764); }
        .g6 { background: linear-gradient(135deg, #1fa2ff, #12d8fa); }
        .g7 { background: linear-gradient(135deg, #f7971e, #ffd200); }
        .g8 { background: linear-gradient(135deg, #606c88, #3f4c6b); }
        .g9 { background: linear-gradient(135deg, #000428, #004e92); }
        .g10 { background: linear-gradient(135deg, #7b4397, #dc2430); }
        .btn-main { background: #ea580c; color: white; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; margin-top: 15px; }
        input, select { border: 1px solid #e2e8f0; padding: 12px; border-radius: 10px; width: 100%; margin-top: 8px; outline: none; background: white; }
        .worker-card { border-left: 5px solid #22c55e; background: white; padding: 15px; border-radius: 12px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen bg-white shadow-2xl">

    <header class="flex items-center justify-between px-6 py-4 border-b bg-white sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div id="adminLogo" class="bg-orange-600 text-white w-10 h-10 flex items-center justify-center rounded-xl text-xl font-bold cursor-pointer select-none">G</div>
            <div>
                <h1 class="font-bold text-lg text-gray-800">Gram Shakti</h1>
                <p id="roleLabel" class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Select State</p>
            </div>
        </div>
        <button onclick="loginPage()" class="text-[10px] font-bold text-orange-600 border border-orange-600 px-2 py-1 rounded">Admin Login</button>
    </header>

    <div id="app" class="p-5 pb-24"></div>

<script>
// --- FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "AIzaSyCuvev3-jwZwQu0_fHYyv2E2ovLny4LhRQ",
  authDomain: "gram-shakti-b135a.firebaseapp.com",
  projectId: "gram-shakti-b135a",
  storageBucket: "gram-shakti-b135a.firebasestorage.app",
  messagingSenderId: "340909973482",
  appId: "1:340909973482:web:c562cb3dd591b78de21c93",
  databaseURL: "https://gram-shakti-b135a-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let selected = { state: "", district: "", panchayat: "", village: "" };
let currentUser = { role: "USER", email: "" };

// --- 1. Master Admin Login (Ravi Bhai) ---
let timer;
document.getElementById("adminLogo").addEventListener("mousedown", () => {
    timer = setTimeout(() => {
        let pass = prompt("Master Password Dalein:");
        if(pass === "Vikas0627.") { 
            currentUser.role = "MAIN_ADMIN";
            document.getElementById("roleLabel").innerText = "MASTER CONTROL";
            showStates();
        }
    }, 2000);
});
document.getElementById("adminLogo").addEventListener("mouseup", () => clearTimeout(timer));

// --- 2. State & District Admin Login ---
function loginPage() {
    document.getElementById("app").innerHTML = `
        <h2 class="text-xl font-bold mb-4">‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h2>
        <input id="logEmail" type="email" placeholder="‡§à‡§Æ‡•á‡§≤ ‡§Ü‡§à‡§°‡•Ä">
        <input id="logPass" type="password" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°">
        <button onclick="authAdmin()" class="btn-main">‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡•á‡§Ç</button>
        <button onclick="showStates()" class="w-full text-xs text-gray-400 mt-4 underline">‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Å</button>
    `;
}

function authAdmin() {
    let email = document.getElementById("logEmail").value;
    let pass = document.getElementById("logPass").value;
    db.ref("adminAccounts").once("value", snap => {
        let found = false;
        snap.forEach(child => {
            let acc = child.val();
            if(acc.email === email && acc.password === pass) {
                found = true;
                currentUser = { role: acc.role, email: email, state: acc.state, dist: acc.dist };
                document.getElementById("roleLabel").innerText = acc.role.replace("_", " ");
                showStates();
            }
        });
        if(!found) alert("‡§ó‡§≤‡§§ ‡§Ü‡§à‡§°‡•Ä ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°!");
    });
}

// --- 3. App flow ---
function showStates() {
    const states = [{n:'Uttar Pradesh',c:'g1'},{n:'Bihar',c:'g2'},{n:'Madhya Pradesh',c:'g3'},{n:'Rajasthan',c:'g4'},{n:'Gujarat',c:'g5'},{n:'Punjab',c:'g6'},{n:'Haryana',c:'g7'},{n:'Maharashtra',c:'g8'},{n:'West Bengal',c:'g9'},{n:'Karnataka',c:'g10'}];
    let html = `<h2 class="text-2xl font-black mb-5">‡§Ö‡§™‡§®‡§æ ‡§∞‡§æ‡§ú‡•ç‡§Ø ‡§ö‡•Å‡§®‡•á‡§Ç</h2><div class="grid grid-cols-2 gap-4">`;
    states.forEach(st => { html += `<div class="state-card ${st.c}" onclick="pickState('${st.n}')">${st.n}</div>`; });
    document.getElementById("app").innerHTML = html + `</div>`;
}

function pickState(s) {
    selected.state = s;
    if(currentUser.role === "MAIN_ADMIN") {
        manageStateAdmin(s);
    } else {
        showDistrictInp();
    }
}

function showDistrictInp() {
    document.getElementById("app").innerHTML = `<h2>${selected.state} - ‡§ú‡§ø‡§≤‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="dist" placeholder="‡§ú‡§ø‡§≤‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ"><button onclick="pickDist()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`;
}

function pickDist() {
    selected.district = document.getElementById("dist").value;
    if(currentUser.role === "MAIN_ADMIN" || currentUser.role === "STATE_ADMIN") {
        manageDistrictAdmin(selected.district);
    } else {
        showPanchayatInp();
    }
}

function showPanchayatInp() {
    document.getElementById("app").innerHTML = `<h2>‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="panch" placeholder="‡§™‡§Ç‡§ö‡§æ‡§Ø‡§§ ‡§ï‡§æ ‡§®‡§æ‡§Æ"><button onclick="selected.panchayat=document.getElementById('panch').value; showVillageInp()" class="btn-main">‡§Ü‡§ó‡•á ‡§¨‡•ù‡•á‡§Ç</button>`;
}

function showVillageInp() {
    document.getElementById("app").innerHTML = `<h2>‡§ó‡§æ‡§Å‡§µ ‡§≤‡§ø‡§ñ‡•á‡§Ç</h2><input id="vill" placeholder="‡§ó‡§æ‡§Å‡§µ ‡§ï‡§æ ‡§®‡§æ‡§Æ"><button onclick="selected.village=document.getElementById('vill').value; showOptions()" class="btn-main">‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>`;
}

function showOptions() {
    document.getElementById("app").innerHTML = `
        <div class="text-center py-6"><h2 class="text-3xl font-black">${selected.village}</h2><p class="text-gray-400">${selected.district}, ${selected.state}</p></div>
        <button onclick="workerForm()" class="btn-main h-16 text-lg">ü§ù ‡§Æ‡•à‡§Ç ‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§π‡•Ç‡§Å</button>
        <button onclick="customerView()" class="btn-main bg-white border-2 border-orange-600 !text-orange-600 h-16 text-lg">üîç ‡§∏‡•á‡§µ‡§æ ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ ‡§π‡•à</button>
    `;
}

// --- 4. Worker Form (Gram Saathi) ---
function workerForm(){
  document.getElementById("app").innerHTML = `
    <h3 class="text-xl font-bold mb-2">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£</h3>
    <input id="wname" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ">
    <input id="wphone" type="tel" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
    <select id="work">
        <option value="">-- ‡§ï‡§æ‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
        <optgroup label="‡§Æ‡§∂‡•Ä‡§®‡§∞‡•Ä & ‡§ñ‡•á‡§§‡•Ä"><option value="JCB Operator">JCB ‡§ë‡§™‡§∞‡•á‡§ü‡§∞</option><option value="Tractor Driver">‡§ü‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§∞ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option><option value="Harvester">‡§π‡§æ‡§∞‡•ç‡§µ‡•á‡§∏‡•ç‡§ü‡§∞</option></optgroup>
        <optgroup label="‡§°‡•á‡§Ø‡§∞‡•Ä"><option value="Dairy/Milk">‡§¶‡•Ç‡§ß ‡§ï‡•Ä ‡§°‡•á‡§Ø‡§∞‡•Ä</option><option value="Pashu Doctor">‡§™‡§∂‡•Å ‡§°‡•â‡§ï‡•ç‡§ü‡§∞</option></optgroup>
        <optgroup label="‡§¶‡•Å‡§ï‡§æ‡§®‡•á‡§Ç"><option value="Kirana">‡§ï‡§ø‡§∞‡§æ‡§®‡§æ ‡§∏‡•ç‡§ü‡•ã‡§∞</option><option value="Medical">‡§Æ‡•á‡§°‡§ø‡§ï‡§≤ ‡§∏‡•ç‡§ü‡•ã‡§∞</option><option value="Tent House">‡§ü‡•á‡§Ç‡§ü ‡§π‡§æ‡§â‡§∏</option><option value="Mobile Repair">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞</option></optgroup>
        <optgroup label="‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä"><option value="Mistri">‡§∞‡§æ‡§ú‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option><option value="Electrician">‡§¨‡§ø‡§ú‡§≤‡•Ä ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option><option value="Plumber">‡§®‡§≤ ‡§Æ‡§ø‡§∏‡•ç‡§§‡•ç‡§∞‡•Ä</option><option value="Tailor">‡§¶‡§∞‡•ç‡§ú‡•Ä</option></optgroup>
        <optgroup label="‡§Ö‡§®‡•ç‡§Ø"><option value="Driver">‡§ï‡§æ‡§∞/‡§ë‡§ü‡•ã ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞</option><option value="Pandit ji">‡§™‡§Ç‡§°‡§ø‡§§ ‡§ú‡•Ä</option><option value="Halwai">‡§π‡§≤‡§µ‡§æ‡§à</option></optgroup>
    </select>
    <input id="villages" placeholder="‡§ï‡§æ‡§Æ ‡§ï‡•á ‡§ó‡§æ‡§Å‡§µ (‡§ó‡§æ‡§Å‡§µ1, ‡§ó‡§æ‡§Å‡§µ2)">
    <button onclick="saveWorker()" class="btn-main">‡§Ö‡§≠‡•Ä ‡§ú‡•Å‡•ú‡•á‡§Ç</button>
  `;
}

function saveWorker(){
  let name = document.getElementById("wname").value; let work = document.getElementById("work").value;
  let phone = document.getElementById("wphone").value; let vInput = document.getElementById("villages").value;
  if(!name || !work || !phone || !vInput) return alert("‡§∏‡§¨ ‡§≠‡§∞‡•á‡§Ç!");
  let id = Date.now();
  let vList = vInput.split(","); let vObj = {};
  vList.forEach(v=>{ let path = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+v.trim()).replace(/\./g, '_'); vObj[path]=true; });
  db.ref("workers/"+id).set({ name, work, phone, villages: vObj });
  alert("‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤!"); showOptions();
}

// --- 5. Customer View ---
function customerView(){
  document.getElementById("app").innerHTML = `<h3 class="font-bold mb-4">‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§∏‡§æ‡§•‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü</h3><div id="list" class="space-y-4"></div>`;
  let currentPath = (selected.state+"/"+selected.district+"/"+selected.panchayat+"/"+selected.village).replace(/\./g, '_');
  db.ref("workers").once("value", snap => {
    snap.forEach(w => {
      let data = w.val();
      if(JSON.stringify(data.villages).includes(currentPath)){
        document.getElementById("list").innerHTML += `
        <div class="worker-card flex justify-between items-center">
            <div><p class="font-bold">${data.name}</p><p class="text-orange-600 text-sm">${data.work}</p></div>
            <a href="tel:${data.phone}" class="bg-green-600 text-white p-3 rounded-full">üìû</a>
        </div>`;
      }
    });
  });
}

// --- 6. Admin Management Logic ---
function manageStateAdmin(s) {
    document.getElementById("app").innerHTML = `
        <h2 class="font-bold mb-4">${s} - ‡§è‡§°‡§Æ‡§ø‡§® ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤</h2>
        <div class="bg-gray-100 p-4 rounded-xl mb-4">
            <p class="text-xs uppercase font-bold text-gray-400">State Head</p>
            <input id="admEmail" placeholder="Email"><input id="admPass" placeholder="Password">
            <button onclick="createAdminAcc('STATE_ADMIN', '${s}')" class="btn-main">Appoint State Admin</button>
        </div>
        <input id="dist" placeholder="‡§ú‡§ø‡§≤‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á">
        <button onclick="pickDist()" class="btn-main bg-black">Manage District</button>
    `;
}

function manageDistrictAdmin(d) {
    document.getElementById("app").innerHTML = `
        <h2 class="font-bold mb-4">${d} - ‡§ú‡§ø‡§≤‡§æ ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤</h2>
        <div class="bg-gray-100 p-4 rounded-xl mb-4">
            <p class="text-xs uppercase font-bold text-gray-400">District Head</p>
            <input id="admEmail" placeholder="Email"><input id="admPass" placeholder="Password">
            <button onclick="createAdminAcc('DIST_ADMIN', '${d}')" class="btn-main">Appoint District Admin</button>
        </div>
        <h4 class="font-bold mb-2">Workers List (For Ban)</h4>
        <div id="banList">Loading...</div>
    `;
    loadBanList(d);
}

function createAdminAcc(role, loc) {
    let email = document.getElementById("admEmail").value;
    let pass = document.getElementById("admPass").value;
    db.ref("adminAccounts/" + Date.now()).set({ email, password: pass, role, state: selected.state, dist: loc });
    alert(role + " Appointed!");
}

function loadBanList(d) {
    db.ref("workers").once("value", snap => {
        let h = "";
        snap.forEach(w => {
            if(JSON.stringify(w.val().villages).includes(d)) {
                h += `<div class="flex justify-between p-2 border-b"><span>${w.val().name}</span><button onclick="ban('${w.key}')" class="text-red-500 font-bold">BAN</button></div>`;
            }
        });
        document.getElementById("banList").innerHTML = h || "No workers";
    });
}
function ban(id) { if(confirm("Ban karein?")) db.ref("workers/"+id).remove(); }

showStates();
</script>
</body>
</html>
